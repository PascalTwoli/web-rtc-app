<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Peers App</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <link rel="stylesheet" href="client.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- Login Screen -->
    <div id="login-screen">
      <div class="login-box">
        <h1>Welcome to Peers</h1>
        <p>Enter your name to join</p>
        <input
          type="text"
          id="usernameInput"
          name="username"
          placeholder="Your Name"
          autofocus
          autocomplete="off"
          spellcheck="false"
          data-lpignore="true"
        />
        <button id="joinBtn">Join</button>
      </div>
    </div>

    <!-- Main App (Hidden initially) -->
    <div id="app" class="hidden">
      <!-- Sidebar (Users & Chat Tabs) -->
      <aside id="sidebar">
        <div class="sidebar-header">
          <div class="header-info">
            <h2>Peers</h2>
            <div id="currentUserDisplay" class="current-user-display hidden">
              <span class="status-dot"></span>
              <span id="myUserNameDisplay">You</span>
            </div>
          </div>
          <div class="header-controls">
            <button
              id="logoutBtn"
              class="control-btn mobile-small hidden"
              title="Logout"
            >
              <svg
                viewBox="0 0 24 24"
                width="16"
                height="16"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
              </svg>
            </button>
            <!-- Close Sidebar Button Removed (Redundant on mobile as Sidebar is Home) -->
          </div>
        </div>

        <div class="sidebar-tabs hidden">
          <!-- Tabs removed as per requirement -->
        </div>

        <!-- Users List Tab -->
        <div id="usersPanel" class="sidebar-section">
          <ul id="usersList"></ul>
        </div>

        <!-- Sidebar Chat Panel Removed -->
      </aside>

      <!-- Main Content -->
      <main id="main-content">
        <!-- 1. Placeholder View -->
        <div id="placeholder-view" class="main-view">
          <div class="placeholder-content">
            <h3>Welcome to Peers</h3>
            <p>Select a user from the sidebar to start chatting or calling.</p>
            <button
              id="openSidebarBtn"
              class="mobile-only"
              style="
                margin-top: 20px;
                padding: 10px 20px;
                background: var(--primary-color);
                border: none;
                border-radius: 20px;
                color: white;
                font-weight: 600;
              "
            >
              View Peers
            </button>
          </div>
        </div>

        <!-- 2. Chat Interface (Pre-Call) -->
        <div id="chat-interface" class="main-view hidden">
          <div class="chat-header">
            <div class="header-left">
              <button
                id="backToUsersBtn"
                class="action-btn mobile-only"
                title="Back"
              >
                <svg
                  viewBox="0 0 24 24"
                  width="24"
                  height="24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M19 12H5M12 19l-7-7 7-7"></path>
                </svg>
              </button>
              <div id="chatAvatar" class="header-avatar">?</div>
              <div class="header-user-info">
                <h3 id="chatUserName">User Name</h3>
                <span class="user-status">Online</span>
              </div>
            </div>
            <div class="chat-actions">
              <button
                id="returnToCallBtn"
                class="hidden"
                title="Return to Call"
              >
                <svg
                  viewBox="0 0 24 24"
                  width="16"
                  height="16"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91"
                  ></path>
                </svg>
                <span>Return</span>
              </button>
              <button
                id="startAudioCallBtn"
                class="action-btn"
                title="Voice Call"
              >
                <svg
                  viewBox="0 0 24 24"
                  width="20"
                  height="20"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91"
                  ></path>
                </svg>
              </button>
              <button
                id="startVideoCallBtn"
                class="action-btn"
                title="Video Call"
              >
                <svg
                  viewBox="0 0 24 24"
                  width="20"
                  height="20"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <polygon points="23 7 16 12 23 17 23 7"></polygon>
                  <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                </svg>
              </button>
            </div>
          </div>
          <div id="mainMessages" class="messages-container"></div>
          <div class="chat-input-area">
            <input
              id="mainChatInput"
              name="message"
              placeholder="Type a message..."
              autocomplete="off"
              spellcheck="false"
              data-lpignore="true"
            />
            <button id="mainSendBtn" class="send-btn">
              <svg
                viewBox="0 0 24 24"
                width="20"
                height="20"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"></path>
              </svg>
            </button>
          </div>
        </div>

        <!-- 3. Video Call Interface (In-Call) -->
        <div id="video-interface" class="main-view hidden">
          <!-- Call Header / Timer -->
          <div id="call-status-bar" class="call-status-bar hidden">
            <div class="call-info">
              <span
                id="app-name-header"
                class="mobile-only"
                style="font-weight: 700; font-size: 16px; margin-bottom: 4px"
                >Peers</span
              >
              <span id="call-status-text">Connected</span>
              <span id="call-timer">00:00</span>
            </div>
          </div>

          <div id="video-grid">
            <div class="video-wrapper local">
              <video id="localVideo" autoplay muted playsinline></video>
              <div id="localAudioPlaceholder" class="audio-placeholder hidden">
                <div class="avatar-circle" id="localAvatarCircle">
                  <!-- Initials will go here -->
                </div>
                <p id="localAudioLabel" class="avatar-name">You</p>
              </div>
              <span id="localVideoLabel" class="video-label">You</span>
            </div>
            <div class="video-wrapper remote">
              <video id="remoteVideo" autoplay playsinline></video>
              <!-- Audio Only Avatar -->
              <div id="audioOnlyPlaceholder" class="audio-placeholder hidden">
                <div class="avatar-circle" id="remoteAvatarCircle">
                  <!-- Initials will go here -->
                </div>
                <p id="remoteAudioLabel" class="avatar-name">User</p>
              </div>
              <span id="remoteVideoLabel" class="video-label">Remote</span>
            </div>
          </div>
        </div>

        <!-- Floating Controls Bar (Only visible in call) -->
        <div id="controls-bar" class="hidden">
          <button id="muteBtn" class="control-btn" title="Toggle Mic">
            <svg
              viewBox="0 0 24 24"
              width="24"
              height="24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"
              ></path>
              <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
              <line x1="12" y1="19" x2="12" y2="23"></line>
              <line x1="8" y1="23" x2="16" y2="23"></line>
            </svg>
          </button>

          <button id="videoBtn" class="control-btn" title="Toggle Video">
            <svg
              viewBox="0 0 24 24"
              width="24"
              height="24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <polygon points="23 7 16 12 23 17 23 7"></polygon>
              <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
            </svg>
          </button>

          <button
            id="flipCameraBtn"
            class="control-btn hidden"
            title="Flip Camera"
          >
            <svg
              viewBox="0 0 24 24"
              width="24"
              height="24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M20 10c0-4.418-3.582-8-8-8s-8 3.582-8 8c0 1.776.576 3.416 1.548 4.752L4 16.5"
              ></path>
              <path
                d="M4 10c0 4.418 3.582 8 8 8s8-3.582 8-8c0-1.776-.576-3.416-1.548-4.752L20 3.5"
              ></path>
              <path d="M4 13.5v3h3"></path>
              <path d="M20 6.5v-3h-3"></path>
            </svg>
          </button>

          <button id="toChatBtn" class="control-btn" title="Chat">
            <svg
              viewBox="0 0 24 24"
              width="24"
              height="24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"
              ></path>
            </svg>
          </button>

          <button id="hangupBtn" class="control-btn danger" title="Hang Up">
            <svg
              viewBox="0 0 24 24"
              width="24"
              height="24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91"
              ></path>
              <line x1="23" y1="1" x2="1" y2="23"></line>
            </svg>
          </button>
        </div>

        <!-- Incoming Call Modal -->
        <div id="incoming-call-modal" class="modal hidden">
          <div class="modal-content">
            <h3 id="incoming-call-type">Incoming Call</h3>
            <p id="caller-name">Unknown User</p>
            <div class="modal-actions">
              <button id="answerCallBtn" class="success">Answer</button>
              <button id="rejectCallBtn" class="danger">Decline</button>
            </div>
          </div>
        </div>

        <!-- Calling Overlay -->
        <div id="calling-overlay" class="hidden">
          <div class="avatar-circle pulsing">
            <svg
              viewBox="0 0 24 24"
              width="60"
              height="60"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91"
              ></path>
            </svg>
          </div>
          <h3 id="calling-text">Calling...</h3>
          <button
            id="cancelCallBtn"
            class="control-btn danger"
            style="margin-top: 60px"
          >
            <svg
              viewBox="0 0 24 24"
              width="24"
              height="24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>

        <!-- Call Ended Overlay -->
        <div id="call-ended-overlay" class="hidden">
          <div
            class="avatar-circle"
            style="background: var(--danger-color); box-shadow: none"
          >
            <svg
              viewBox="0 0 24 24"
              width="48"
              height="48"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91"
              ></path>
              <line x1="23" y1="1" x2="1" y2="23"></line>
            </svg>
          </div>
          <h3>Call Ended</h3>
          <p
            id="call-ended-duration"
            style="color: var(--text-secondary); margin-top: 10px"
          >
            00:00
          </p>
        </div>
      </main>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <audio id="remoteRingtone" src="./hyunjin_ringtone.mp3" loop muted></audio>
    <script src="client.js"></script>
  </body>
</html>
